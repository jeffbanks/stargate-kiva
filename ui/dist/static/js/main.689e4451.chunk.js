(this["webpackJsonpstargate-kiva"]=this["webpackJsonpstargate-kiva"]||[]).push([[0],{14:function(e,t,n){},16:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(4),c=n.n(o),s=(n(14),n(1)),i=n.n(s),u=n(2),l=n(5),d=n(3),p=n.n(d);n(16);function _(e,t,n,a){for(var r=[],o=e.funded_amount,c=n/t,s=[e.low,e.high],i=0,u=0;u<s.length;u++)r.push(i),i+=s[u];var l,d=o>=1.5*c?22:o>=c?20:o>=.5*c?18:16,p=o>=1.5*c?50:o>=c?32:o>=.5*c?24:18,_=Math.round(.6*p),v=2*p,T='<div><svg width="'+v+'" height="'+v+'" viewbox="0 0 '+v+" "+v+'" text-anchor="middle" style="font: '+d+'px sans-serif; display: block">';for(u=0;u<s.length;u++)T+=f(r[u]/i,(r[u]+s[u])/i,p,_,a[u]);T+='<circle cx="'+p+'" cy="'+p+'" r="'+_+'" fill="white" /><text dominant-baseline="central" transform="translate('+p+", "+p+')">'+(((l=e.funded_amount)>=Math.pow(10,9)?(l/Math.pow(10,9)).toFixed(0)+"B":l>=Math.pow(10,6)?(l/Math.pow(10,6)).toFixed(0)+"M":l>=Math.pow(10,3)?(l/Math.pow(10,3)).toFixed(0)+"K":l)+"</text></svg></div>");var E=document.createElement("div");return E.innerHTML=T,E.firstChild}function f(e,t,n,a,r){t-e===1&&(t-=1e-5);var o=2*Math.PI*(e-.25),c=2*Math.PI*(t-.25),s=Math.cos(o),i=Math.sin(o),u=Math.cos(c),l=Math.sin(c),d=t-e>.5?1:0;return['<path d="M',n+a*s,n+a*i,"L",n+n*s,n+n*i,"A",n,n,0,d,1,n+n*u,n+n*l,"L",n+a*u,n+a*l,"A",a,a,0,d,0,n+a*s,n+a*i,'" fill="'+r+'" />'].join(" ")}function v(e){return{type:"Feature",properties:e,geometry:{type:"Point",coordinates:[e.lon,e.lat]}}}var T=n(7),E=n(8),O=n(17),h=(n(18),"GET"),S="POST",m="PUT",b="PATCH",C="DELETE",g=function(){var e=Object(u.a)(i.a.mark((function e(){var t,n,a,r,o,c=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:"",n=c.length>1&&void 0!==c[1]?c[1]:"",a=c.length>2&&void 0!==c[2]?c[2]:"",r=c.length>3&&void 0!==c[3]?c[3]:null,o=void 0,n!==h){e.next=10;break}return e.next=8,O(t,{method:n,headers:{Accepts:"application/json","Content-Type":"application/json","X-Cassandra-Token":a},redirect:"follow"});case 8:return o=e.sent,e.abrupt("return",o);case 10:if(n!==C){e.next=15;break}return e.next=13,O(t,{method:n,headers:{Accepts:"application/json","Content-Type":"application/json","X-Cassandra-Token":a},redirect:"follow",body:r?JSON.stringify(r):null});case 13:return o=e.sent,e.abrupt("return",o);case 15:return e.next=17,O(t,{method:n,headers:{Accepts:"application/json","Content-Type":"application/json","X-Cassandra-Token":a},redirect:"follow",body:A(r)?r:JSON.stringify(r)});case 17:return o=e.sent,e.abrupt("return",o);case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(e){if("string"!==typeof e)return!1;try{var t=JSON.parse(e),n=Object.prototype.toString.call(t);return Boolean("[object Object]"===n||"[object Array]"===n)}catch(a){return!1}},y=function(){function e(t,n){Object(T.a)(this,e),this.baseUrl=t,this.accessToken=n}return Object(E.a)(e,[{key:"get",value:function(e){return g(this.baseUrl+e,h,this.accessToken)}},{key:"post",value:function(e,t){return g(this.baseUrl+e,S,this.accessToken,t)}},{key:"put",value:function(e,t){return g(this.baseUrl+e,m,this.accessToken,t)}},{key:"patch",value:function(e,t){return g(this.baseUrl+e,b,this.accessToken,t)}},{key:"delete",value:function(e){return g(this.baseUrl+e,C,this.accessToken)}}]),e}(),P=function(){var e=Object(u.a)(i.a.mark((function e(t,n){var a,r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=11;break}return e.next=3,g(t.baseUrl+"/api/rest/v1/auth",S,"",{username:t.username,password:t.password});case 3:return a=e.sent,e.next=6,a.json();case 6:return r=e.sent,o=r.authToken,e.abrupt("return",new y(t.baseUrl+"/api/rest/v2",o));case 11:return e.abrupt("return",new y(t.baseUrl+"/api/rest/v2",n));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();p.a.accessToken=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_MAPBOX_KEY;var x=function(){var e=Object(a.useRef)(null),t=Object(a.useState)(5),n=Object(l.a)(t,2),o=n[0],s=n[1],d=Object(a.useState)(34),f=Object(l.a)(d,2),T=f[0],E=f[1],O=Object(a.useState)(1.5),h=Object(l.a)(O,2),S=h[0],m=h[1];function b(t){var n=new p.a.Map({container:e.current,style:"mapbox://styles/mapbox/dark-v10",center:[o,T],zoom:S});n.addControl(new p.a.NavigationControl,"top-right"),n.on("move",(function(){s(n.getCenter().lng.toFixed(4)),E(n.getCenter().lat.toFixed(4)),m(n.getZoom().toFixed(2))})),n.on("load",(function(){for(var e=Number.MAX_SAFE_INTEGER,a=0,o=0,s=0;s<t.length;s++){var i=t[s].properties.funded_amount;o+=i,i<e&&(e=i),i>a&&(a=i)}var u=(a-e)/2,l={type:"FeatureCollection",features:t},d=["<",["get","funded_amount"],u],f=[">=",["get","funded_amount"],u];n.addSource("kiva-loans",function(e,t,n){return{type:"geojson",data:e,cluster:!0,clusterRadius:80,clusterProperties:{low:["+",["case",t,1,0]],high:["+",["case",n,1,0]],funded_amount:["+",["get","funded_amount"]]}}}(l,d,f));var v=["#f26375","#acf0a5"];n.addLayer(function(e,t,n){return{id:"loan_clusters",type:"circle",source:"kiva-loans",filter:["!=","cluster",!0],paint:{"circle-color":["case",e,n[0],t,n[1],n[1]],"circle-opacity":.6,"circle-radius":12}}}(d,f,v)),n.addLayer({id:"loan_dots",type:"symbol",source:"kiva-loans",filter:["!=","cluster",!0],layout:{"text-field":["number-format",["get","funded_amount"],{"min-fraction-digits":1,"max-fraction-digits":1}],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10},paint:{"text-color":"white"}});var T={},E={};function O(){for(var e={},t=n.querySourceFeatures("kiva-loans"),a=0;a<t.length;a++){var r=t[a].geometry.coordinates,c=t[a].properties;if(c.cluster){var s=c.cluster_id,i=T[s];if(!i){var u=_(c,t.length,o,v);i=T[s]=new p.a.Marker({element:u}).setLngLat(r)}e[s]=i,E[s]||i.addTo(n)}}for(s in E)e[s]||E[s].remove();E=e}n.on("data",(function(e){"kiva-loans"===e.sourceId&&e.isSourceLoaded&&(n.on("move",O),n.on("moveend",O),O())})),n.on("click","loan_dots",(function(e){var t=e.features[0].geometry.coordinates.slice(),a=document.createElement("div");for(c.a.render(function(e){var t=e.tags&&JSON.parse(e.tags),n=e.use;return n&&n.length>300&&(n=n.substring(0,300)+"..."),r.a.createElement("div",{style:{width:200}},r.a.createElement("b",null,e.country_name),r.a.createElement("p",null,"Town: ",e.town),r.a.createElement("p",null,"Loan: $ ",e.loan_amount.toFixed(2)),r.a.createElement("p",null,"Funded: $ ",e.funded_amount.toFixed(2)),r.a.createElement("br",null),r.a.createElement("p",null,n),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement("b",null,Array.isArray(t)&&t.join(", "))))}(e.features[0].properties),a);Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;(new p.a.Popup).setLngLat(t).setDOMContent(a).addTo(n)})),n.on("mouseenter","loan_dots",(function(){n.getCanvas().style.cursor="pointer"})),n.on("mouseleave","loan_dots",(function(){n.getCanvas().style.cursor=""}))}))}return Object(a.useEffect)((function(){var e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_ASTRA_DB_ID,t=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_ASTRA_DB_REGION,n=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_STARGATE_USERNAME,a=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_STARGATE_PASSWORD,r=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_TOKEN,o=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_ASTRA_KEYSPACE,c=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_ASTRA_COLLECTION,s="/namespaces/".concat(o,"/collections/").concat(c,"/"),l='?where={"posted_time": { "$gte": "2000-01-01" } }';function d(e){return p.apply(this,arguments)}function p(){return(p=Object(u.a)(i.a.mark((function o(c){var l,d,p;return i.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,P({baseUrl:"https://".concat(e,"-").concat(t,".apps.astra.datastax.com"),username:n,password:a},r);case 2:for(l=o.sent,d=[],p=0;p<c.length;p++)d.push(l.get(s+c[p]));Promise.all(d).then(function(){var e=Object(u.a)(i.a.mark((function e(t){var n,a,r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a=0;case 2:if(!(a<c.length)){e.next=11;break}return e.next=5,t[a].json();case 5:r=e.sent,o=v(r.data),n.push(o);case 8:a++,e.next=2;break;case 11:b(n);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return o.stop()}}),o)})))).apply(this,arguments)}function _(){return(_=Object(u.a)(i.a.mark((function o(){var c,u,p;return i.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,P({baseUrl:"https://".concat(e,"-").concat(t,".apps.astra.datastax.com"),username:n,password:a},r);case 2:return c=o.sent,o.next=5,c.get(s+l);case 5:return u=o.sent,o.next=8,u.json();case 8:p=o.sent,d(Object.keys(p.data));case 11:case"end":return o.stop()}}),o)})))).apply(this,arguments)}!function(){_.apply(this,arguments)}()}),[]),r.a.createElement("div",null,r.a.createElement("div",{className:"sidebarStyle"},r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("b",null,"STARGATE  ^ Colonel Jack")),"Longitude: ",o," | Latitude: ",T," | Zoom: ",S)),r.a.createElement("div",{className:"map-container",ref:e}))};var k=function(){return r.a.createElement("div",null,r.a.createElement(x,null))};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(k,null)),document.getElementById("root"))},9:function(e,t,n){e.exports=n(21)}},[[9,1,2]]]);
//# sourceMappingURL=main.689e4451.chunk.js.map