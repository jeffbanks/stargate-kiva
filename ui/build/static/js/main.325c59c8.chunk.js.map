{"version":3,"sources":["utils.js","stargate.js","Map.js","map/clusterSource.js","map/layers.js","App.js","index.js"],"names":["renderRing","props","numOfClusters","totalFunding","colors","offsets","funded_amount","fundingAvg","counts","low","high","total","i","length","push","value","fontSize","r","r0","Math","round","w","html","segment","toFixed","el","document","createElement","innerHTML","firstChild","start","end","color","a0","PI","a1","x0","cos","y0","sin","x1","y1","largeArc","join","buildGeoFeature","doc","lon","lat","fetch","require","methods","request","a","url","method","accessToken","data","res","undefined","headers","Accepts","redirect","body","JSON","stringify","hasJsonStructure","result","parse","type","Object","prototype","toString","call","Boolean","err","Client","baseUrl","this","path","createClient","connection","token","username","password","json","jsonResult","authToken","mapboxgl","process","Map","mapContainerRef","useRef","useState","lng","setLng","setLat","zoom","setZoom","renderMap","features","map","container","current","style","center","addControl","NavigationControl","on","getCenter","getZoom","min","Number","MAX_SAFE_INTEGER","max","properties","threshold","featureCollection","addSource","clusterSource","addLayer","circleLayer","markers","markersOnScreen","updateMarkers","newMarkers","querySourceFeatures","coords","geometry","coordinates","cluster","id","cluster_id","marker","Marker","element","setLngLat","addTo","remove","e","sourceId","isSourceLoaded","slice","placeholder","ReactDOM","render","tags","text","use","substring","width","country_name","town","loan_amount","Array","isArray","buildDialog","abs","lngLat","Popup","setDOMContent","getCanvas","cursor","useEffect","db","baseQuery","whereClause","fetchDocs","ids","sg","promises","get","Promise","all","then","results","feature","response","keys","fetchIds","className","ref","App","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.325c59c8.chunk.js","sourcesContent":["import React from 'react';\n\nfunction shortenNumber(value) {\n   if (value >= 10**9)\n      return (value / 10**9).toFixed(0) + 'B';\n   if (value >= 10**6)\n      return (value / 10**6).toFixed(0) + 'M';\n   if (value >= 10**3)\n      return (value / 10**3).toFixed(0) + 'K';\n   return value;\n}\n\nexport function renderRing(props, numOfClusters, totalFunding, colors) {\n    var offsets = [];\n    var funded_amount = props.funded_amount;\n    var fundingAvg = totalFunding / numOfClusters;\n    var counts = [\n        props.low,\n        props.high\n    ];\n    var total = 0;\n    for (var i = 0; i < counts.length; i++) {\n        offsets.push(total);\n        total += counts[i];\n    }\n    var fontSize = funded_amount >= fundingAvg * 1.5  ? 22 :\n            funded_amount >= fundingAvg        ? 20 :\n            funded_amount >= fundingAvg * .5   ? 18 : 16;\n    var r = funded_amount >= fundingAvg * 1.5  ? 50 :\n            funded_amount >= fundingAvg        ? 32 :\n            funded_amount >= fundingAvg * .5   ? 24 : 18;\n    var r0 = Math.round(r * 0.6);\n    var w = r * 2;\n\n    var html =\n        '<div><svg width=\"' +\n        w +\n        '\" height=\"' +\n        w +\n        '\" viewbox=\"0 0 ' +\n        w +\n        ' ' +\n        w +\n        '\" text-anchor=\"middle\" style=\"font: ' +\n        fontSize +\n        'px sans-serif; display: block\">';\n\n    for (i = 0; i < counts.length; i++) {\n        html += segment(\n            offsets[i] / total,\n            (offsets[i] + counts[i]) / total,\n            r,\n            r0,\n            colors[i]\n        );\n    }\n    html +=\n        '<circle cx=\"'+r+'\" cy=\"'+r+'\" r=\"'+r0+'\" fill=\"white\" /><text dominant-baseline=\"central\" transform=\"translate(' +\n        r +\n        ', ' +\n        r +\n        ')\">' +\n        shortenNumber(props.funded_amount) +\n        '</text></svg></div>';\n\n    var el = document.createElement('div');\n    el.innerHTML = html;\n    return el.firstChild;\n}\n\nfunction segment(start, end, r, r0, color) {\n        if (end - start === 1) end -= 0.00001;\n        var a0 = 2 * Math.PI * (start - 0.25);\n        var a1 = 2 * Math.PI * (end - 0.25);\n        var x0 = Math.cos(a0),\n            y0 = Math.sin(a0);\n        var x1 = Math.cos(a1),\n            y1 = Math.sin(a1);\n        var largeArc = end - start > 0.5 ? 1 : 0;\n\n        return [\n            '<path d=\"M',\n            r + r0 * x0,\n            r + r0 * y0,\n            'L',\n            r + r * x0,\n            r + r * y0,\n            'A',\n            r,\n            r,\n            0,\n            largeArc,\n            1,\n            r + r * x1,\n            r + r * y1,\n            'L',\n            r + r0 * x1,\n            r + r0 * y1,\n            'A',\n            r0,\n            r0,\n            0,\n            largeArc,\n            0,\n            r + r0 * x0,\n            r + r0 * y0,\n            '\" fill=\"' + color + '\" />'\n        ].join(' ');\n    }\n\nexport function buildGeoFeature(doc) {\n   return {\n      \"type\": \"Feature\", \n      \"properties\": doc,\n      \"geometry\": { \n        \"type\": \"Point\", \n        \"coordinates\": [ doc.lon,\n                          doc.lat ] \n      }\n   }\n}\n\nexport function buildDialog(props) {\n   const tags = props.tags && JSON.parse(props.tags);\n   var text = props.use;\n   if (text && text.length > 300)\n      text =  text.substring(0, 300) + \"...\";\n   return (\n      <div style={{width: 200}}>\n         <b>{props.country_name}</b>\n         <p>Town: {props.town}</p>\n         <p>Loan: $ {props.loan_amount.toFixed(2)}</p>\n         <p>Funded: $ {props.funded_amount.toFixed(2)}</p>\n         <br/>\n         <p>{text}</p>\n         <br/>\n         <p><b>{Array.isArray(tags) && tags.join(\", \")}</b></p>\n      </div>\n   );\n}\n","const fetch = require(\"node-fetch\");\nconst _ = require(\"lodash\");\n\nconst methods = {\n  get: \"GET\",\n  post: \"POST\",\n  put: \"PUT\",\n  patch: \"PATCH\",\n  delete: \"DELETE\",\n};\n\nconst request = async (\n  url = \"\",\n  method = \"\",\n  accessToken = \"\",\n  data = null\n) => {\n\n  let res = undefined;\n\n  if (method === methods.get) {\n    res = await fetch(url, {\n      method,\n      headers: {\n        Accepts: \"application/json\",\n        \"Content-Type\": \"application/json\",\n        \"X-Cassandra-Token\": accessToken,\n      },\n      redirect: \"follow\",\n    });\n    return res;\n  }\n\n  if (method === methods.delete) {\n    res = await fetch(url, {\n      method,\n      headers: {\n        Accepts: \"application/json\",\n        \"Content-Type\": \"application/json\",\n        \"X-Cassandra-Token\": accessToken,\n      },\n      redirect: \"follow\",\n      body: data ? JSON.stringify(data) : null\n    });\n    return res;\n  }\n\n  // All other cases for now will use this approach for fetch.\n  res = await fetch(url, {\n    method,\n    headers: {\n      Accepts: \"application/json\",\n      \"Content-Type\": \"application/json\",\n      \"X-Cassandra-Token\": accessToken,\n    },\n    redirect: \"follow\",\n    body: hasJsonStructure(data) ? data : JSON.stringify(data),\n  });\n\n  return res;\n};\n\n// Performs check as we may already have a json structure.\nexport const hasJsonStructure = (data) => {\n  if (typeof data !== 'string') return false;\n  try {\n    const result = JSON.parse(data);\n    const type = Object.prototype.toString.call(result);\n    const isObjOrArray = Boolean(type === '[object Object]'\n      || type === '[object Array]');\n    return isObjOrArray;\n  } catch (err) {\n    return false;\n  }\n};\n\nexport default class Client {\n  constructor(baseUrl, accessToken) {\n    this.baseUrl = baseUrl;\n    this.accessToken = accessToken;\n  }\n\n  get(path) {\n    return request(this.baseUrl + path, methods.get, this.accessToken);\n  }\n\n  post(path, data) {\n    return request(this.baseUrl + path, methods.post, this.accessToken, data);\n  }\n\n  put(path, data) {\n    return request(this.baseUrl + path, methods.put, this.accessToken, data);\n  }\n\n  patch(path, data) {\n    return request(this.baseUrl + path, methods.patch, this.accessToken, data);\n  }\n\n  delete(path) {\n    return request(this.baseUrl + path, methods.delete, this.accessToken);\n  }\n}\n\nexport const createClient = async (connection, token) => {\n\n  // Able to have .env entry with token for reuse.\n  // if not specified, generate one!\n  if (!token) {\n    const res = await request(\n      connection.baseUrl + \"/api/rest/v1/auth\",\n      methods.post,\n      \"\",\n      {\n        username: connection.username,\n        password: connection.password,\n      }\n    );\n    const jsonResult = await res.json();\n    const authToken = jsonResult.authToken;\n    return new Client(\n      connection.baseUrl + \"/api/rest/v2\",\n      authToken\n    );\n  } else {\n    return new Client(\n      connection.baseUrl + \"/api/rest/v2\", token\n    );\n  }\n};\n","import React, { useRef, useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport mapboxgl from 'mapbox-gl';\nimport './Map.css';\nimport { buildGeoFeature, buildDialog, renderRing } from './utils';\nimport { createClient } from './stargate';\nimport { circleLayer, textLayer } from './map/layers';\nimport { clusterSource } from './map/clusterSource';\n\nmapboxgl.accessToken = process.env.REACT_APP_MAPBOX_KEY;\n\nconst Map = () => {\n  const mapContainerRef = useRef(null);\n\n  const [lng, setLng] = useState(5);\n  const [lat, setLat] = useState(34);\n  const [zoom, setZoom] = useState(1.5);\n\n\n  function renderMap(features) {\n\n    // https://docs.mapbox.com/mapbox-gl-js/example/cluster-html/\n    const map = new mapboxgl.Map({\n      container: mapContainerRef.current,\n      style: 'mapbox://styles/mapbox/dark-v10',\n      center: [lng, lat],\n      zoom: zoom\n    });\n\n    // Add navigation control (the +/- zoom buttons)\n    map.addControl(new mapboxgl.NavigationControl(), 'top-right');\n\n    // add move handler to update position panel\n    map.on('move', () => {\n      setLng(map.getCenter().lng.toFixed(4));\n      setLat(map.getCenter().lat.toFixed(4));\n      setZoom(map.getZoom().toFixed(2));\n    });\n\n    map.on('load', function () {\n\n      var min = Number.MAX_SAFE_INTEGER;\n      var max = 0;\n      var totalFunding = 0;\n      for (var i = 0; i < features.length; i++) {\n        const funded_amount = features[i].properties.funded_amount;\n        totalFunding += funded_amount;\n        if (funded_amount < min)\n          min = funded_amount\n        if (funded_amount > max)\n          max = funded_amount \n        }   \n      var threshold = ((max - min) / 2)\n      const featureCollection = {\n        \"type\": \"FeatureCollection\",\n        \"features\": features\n      }\n\n    var low = ['<', ['get', 'funded_amount'], threshold];\n    var high = ['>=', ['get', 'funded_amount'], threshold];\n\n    // Add a geojson point source.\n    map.addSource('kiva-loans', clusterSource(featureCollection, low, high));\n\n    // colors to use for the categories\n    var colors = ['#f26375', '#acf0a5'];\n    \n      \n    // circle and symbol layers for rendering individual loans (unclustered points)\n    map.addLayer(circleLayer(low, high, colors));\n    map.addLayer(textLayer());\n      \n\n      // objects for caching and keeping track of HTML marker objects (for performance)\n      var markers = {};\n      var markersOnScreen = {};\n\n      function updateMarkers() {\n          var newMarkers = {};\n          var features = map.querySourceFeatures('kiva-loans');\n\n          // for every cluster on the screen, create an HTML marker for it (if we didn't yet),\n          // and add it to the map if it's not there already\n          for (var i = 0; i < features.length; i++) {\n              var coords = features[i].geometry.coordinates;\n              var props = features[i].properties;\n              if (!props.cluster) continue;\n              var id = props.cluster_id;\n\n              var marker = markers[id];\n              if (!marker) {\n                  var el = renderRing(props, features.length, totalFunding, colors);\n                  marker = markers[id] = new mapboxgl.Marker({\n                      element: el\n                  }).setLngLat(coords);\n              }\n              newMarkers[id] = marker;\n\n              if (!markersOnScreen[id]) marker.addTo(map);\n          }\n          // for every marker we've added previously, remove those that are no longer visible\n          for (id in markersOnScreen) {\n              if (!newMarkers[id]) markersOnScreen[id].remove();\n          }\n          markersOnScreen = newMarkers;\n      }\n\n      // after the GeoJSON data is loaded, update markers on the screen and do so on every map move/moveend\n      map.on('data', function (e) {\n          if (e.sourceId !== 'kiva-loans' || !e.isSourceLoaded) return;\n          map.on('move', updateMarkers);\n          map.on('moveend', updateMarkers);\n          updateMarkers();\n      });\n\n      map.on('click', 'loan_dots', function (e) {\n        var coordinates = e.features[0].geometry.coordinates.slice();\n        \n        const placeholder = document.createElement('div');\n        ReactDOM.render(buildDialog(e.features[0].properties), placeholder);\n         \n        // Ensure that if the map is zoomed out such that multiple\n        // copies of the feature are visible, the popup appears\n        // over the copy being pointed to.\n        while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n          coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n        }\n         \n        new mapboxgl.Popup()\n          .setLngLat(coordinates)\n          .setDOMContent(placeholder)\n          .addTo(map);\n      });\n         \n      // Change the cursor to a pointer when the mouse is over the places layer.\n      map.on('mouseenter', 'loan_dots', function () {\n        map.getCanvas().style.cursor = 'pointer';\n      });\n         \n      // Change it back to a pointer when it leaves.\n      map.on('mouseleave', 'loan_dots', function () {\n        map.getCanvas().style.cursor = '';\n      });\n        \n    });\n  }\n\n  // Initialize map when component mounts\n  useEffect(() => {\n\n    \n    const db = process.env.REACT_APP_ASTRA_DB_ID,\n      region = process.env.REACT_APP_ASTRA_DB_REGION,\n      username = process.env.REACT_APP_STARGATE_USERNAME,\n      password = process.env.REACT_APP_STARGATE_PASSWORD,\n      token = process.env.REACT_APP_TOKEN,\n      namespace = process.env.REACT_APP_ASTRA_KEYSPACE,\n      collection = process.env.REACT_APP_ASTRA_COLLECTION,\n      baseQuery = `/namespaces/${namespace}/collections/${collection}/`,\n      whereClause = '?where={\"posted_time\": { \"$gte\": \"2000-01-01\" } }';\n\n    async function fetchDocs(ids) {\n      const sg = await createClient({\n        baseUrl: `https://${db}-${region}.apps.astra.datastax.com`,\n        username,\n        password,\n      }, token);\n\n      var promises = [];\n      for (var i = 0; i < ids.length; i++) {\n        promises.push(sg.get(baseQuery + ids[i]));\n      }\n\n      Promise.all(promises).then(async results => {\n        var features = [];\n        for (var i = 0; i < ids.length; i++) {\n          const body = await results[i].json();\n          const feature = buildGeoFeature(body.data);\n          features.push(feature);\n        }\n        renderMap(features);\n      });\n    }\n\n    async function fetchIds() {\n      const sg = await createClient({\n        baseUrl: `https://${db}-${region}.apps.astra.datastax.com`,\n        username,\n        password,\n      }, token);\n      const response = await sg.get(baseQuery + whereClause);\n      const body = await response.json();\n      const ids = Object.keys(body.data);\n      fetchDocs(ids);\n    }\n    fetchIds();\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return (\n    <div>\n      <div className='sidebarStyle'>\n        <div>\n          <p><b>STARGATE  &#94; Colonel Jack</b></p>  \n          Longitude: {lng} | Latitude: {lat} | Zoom: {zoom}\n        </div>\n      </div>\n      <div className='map-container' ref={mapContainerRef} />\n    </div>\n  );\n};\n\nexport default Map;","export function clusterSource(featureCollection, low, high) {\n  return {\n    'type': 'geojson',\n    'data': featureCollection,\n    'cluster': true,\n    'clusterRadius': 80,\n    'clusterProperties': {\n        // keep separate counts for each magnitude category in a cluster\n        'low': ['+', ['case', low, 1, 0]],\n        'high': ['+', ['case', high, 1, 0]],\n        'funded_amount': ['+', ['get', 'funded_amount']]\n    }\n  }\n}","export function textLayer() {\n  return {\n    'id': 'loan_dots',\n    'type': 'symbol',\n    'source': 'kiva-loans',\n    'filter': ['!=', 'cluster', true],\n    'layout': {\n        'text-field': [\n            'number-format',\n            ['get', 'funded_amount'],\n            { 'min-fraction-digits': 1, 'max-fraction-digits': 1 }\n        ],\n        'text-font': ['Open Sans Semibold', 'Arial Unicode MS Bold'],\n        'text-size': 10\n    },\n    'paint': {\n        'text-color': 'white'\n    }\n  }\n};\n\nexport function circleLayer(low, high, colors) {\n  return {\n    'id': 'loan_clusters',\n    'type': 'circle',\n    'source': 'kiva-loans',\n    'filter': ['!=', 'cluster', true],\n    'paint': {\n        'circle-color': [\n            'case',\n            low,\n            colors[0],\n            high,\n            colors[1],\n            colors[1]\n        ],\n        'circle-opacity': 0.6,\n        'circle-radius': 12\n    }\n  }\n};","import React from 'react';\nimport Map from './Map';\n\nfunction App() {\n  return (\n    <div>\n      <Map />\n    </div>\n  );\n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}