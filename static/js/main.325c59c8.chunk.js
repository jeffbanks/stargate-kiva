(this["webpackJsonpstargate-kiva"]=this["webpackJsonpstargate-kiva"]||[]).push([[0],{14:function(e,t,n){},16:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(4),s=n.n(o),c=(n(14),n(1)),i=n.n(c),u=n(2),l=n(5),d=n(3),p=n.n(d);n(16);function f(e,t,n,a){for(var r=[],o=e.funded_amount,s=n/t,c=[e.low,e.high],i=0,u=0;u<c.length;u++)r.push(i),i+=c[u];var l,d=o>=1.5*s?22:o>=s?20:o>=.5*s?18:16,p=o>=1.5*s?50:o>=s?32:o>=.5*s?24:18,f=Math.round(.6*p),v=2*p,m='<div><svg width="'+v+'" height="'+v+'" viewbox="0 0 '+v+" "+v+'" text-anchor="middle" style="font: '+d+'px sans-serif; display: block">';for(u=0;u<c.length;u++)m+=h(r[u]/i,(r[u]+c[u])/i,p,f,a[u]);m+='<circle cx="'+p+'" cy="'+p+'" r="'+f+'" fill="white" /><text dominant-baseline="central" transform="translate('+p+", "+p+')">'+(((l=e.funded_amount)>=Math.pow(10,9)?(l/Math.pow(10,9)).toFixed(0)+"B":l>=Math.pow(10,6)?(l/Math.pow(10,6)).toFixed(0)+"M":l>=Math.pow(10,3)?(l/Math.pow(10,3)).toFixed(0)+"K":l)+"</text></svg></div>");var b=document.createElement("div");return b.innerHTML=m,b.firstChild}function h(e,t,n,a,r){t-e===1&&(t-=1e-5);var o=2*Math.PI*(e-.25),s=2*Math.PI*(t-.25),c=Math.cos(o),i=Math.sin(o),u=Math.cos(s),l=Math.sin(s),d=t-e>.5?1:0;return['<path d="M',n+a*c,n+a*i,"L",n+n*c,n+n*i,"A",n,n,0,d,1,n+n*u,n+n*l,"L",n+a*u,n+a*l,"A",a,a,0,d,0,n+a*c,n+a*i,'" fill="'+r+'" />'].join(" ")}function v(e){return{type:"Feature",properties:e,geometry:{type:"Point",coordinates:[e.lon,e.lat]}}}var m=n(7),b=n(8),g=n(17),y=(n(18),"GET"),k="POST",x="PUT",w="PATCH",j="DELETE",E=function(){var e=Object(u.a)(i.a.mark((function e(){var t,n,a,r,o,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:"",n=s.length>1&&void 0!==s[1]?s[1]:"",a=s.length>2&&void 0!==s[2]?s[2]:"",r=s.length>3&&void 0!==s[3]?s[3]:null,o=void 0,n!==y){e.next=10;break}return e.next=8,g(t,{method:n,headers:{Accepts:"application/json","Content-Type":"application/json","X-Cassandra-Token":a},redirect:"follow"});case 8:return o=e.sent,e.abrupt("return",o);case 10:if(n!==j){e.next=15;break}return e.next=13,g(t,{method:n,headers:{Accepts:"application/json","Content-Type":"application/json","X-Cassandra-Token":a},redirect:"follow",body:r?JSON.stringify(r):null});case 13:return o=e.sent,e.abrupt("return",o);case 15:return e.next=17,g(t,{method:n,headers:{Accepts:"application/json","Content-Type":"application/json","X-Cassandra-Token":a},redirect:"follow",body:T(r)?r:JSON.stringify(r)});case 17:return o=e.sent,e.abrupt("return",o);case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(e){if("string"!==typeof e)return!1;try{var t=JSON.parse(e),n=Object.prototype.toString.call(t);return Boolean("[object Object]"===n||"[object Array]"===n)}catch(a){return!1}},O=function(){function e(t,n){Object(m.a)(this,e),this.baseUrl=t,this.accessToken=n}return Object(b.a)(e,[{key:"get",value:function(e){return E(this.baseUrl+e,y,this.accessToken)}},{key:"post",value:function(e,t){return E(this.baseUrl+e,k,this.accessToken,t)}},{key:"put",value:function(e,t){return E(this.baseUrl+e,x,this.accessToken,t)}},{key:"patch",value:function(e,t){return E(this.baseUrl+e,w,this.accessToken,t)}},{key:"delete",value:function(e){return E(this.baseUrl+e,j,this.accessToken)}}]),e}(),M=function(){var e=Object(u.a)(i.a.mark((function e(t,n){var a,r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=11;break}return e.next=3,E(t.baseUrl+"/api/rest/v1/auth",k,"",{username:t.username,password:t.password});case 3:return a=e.sent,e.next=6,a.json();case 6:return r=e.sent,o=r.authToken,e.abrupt("return",new O(t.baseUrl+"/api/rest/v2",o));case 11:return e.abrupt("return",new O(t.baseUrl+"/api/rest/v2",n));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();p.a.accessToken="pk.eyJ1IjoiZ3JpZ2hldHRvIiwiYSI6ImNrZXhpdjFiOTBhM2wzN2w2ZnhlazZxazcifQ.ZEc00nzkLDSdsBluckj1dA";var S=function(){var e=Object(a.useRef)(null),t=Object(a.useState)(5),n=Object(l.a)(t,2),o=n[0],c=n[1],d=Object(a.useState)(34),h=Object(l.a)(d,2),m=h[0],b=h[1],g=Object(a.useState)(1.5),y=Object(l.a)(g,2),k=y[0],x=y[1];function w(t){var n=new p.a.Map({container:e.current,style:"mapbox://styles/mapbox/dark-v10",center:[o,m],zoom:k});n.addControl(new p.a.NavigationControl,"top-right"),n.on("move",(function(){c(n.getCenter().lng.toFixed(4)),b(n.getCenter().lat.toFixed(4)),x(n.getZoom().toFixed(2))})),n.on("load",(function(){for(var e=Number.MAX_SAFE_INTEGER,a=0,o=0,c=0;c<t.length;c++){var i=t[c].properties.funded_amount;o+=i,i<e&&(e=i),i>a&&(a=i)}var u=(a-e)/2,l={type:"FeatureCollection",features:t},d=["<",["get","funded_amount"],u],h=[">=",["get","funded_amount"],u];n.addSource("kiva-loans",function(e,t,n){return{type:"geojson",data:e,cluster:!0,clusterRadius:80,clusterProperties:{low:["+",["case",t,1,0]],high:["+",["case",n,1,0]],funded_amount:["+",["get","funded_amount"]]}}}(l,d,h));var v=["#f26375","#acf0a5"];n.addLayer(function(e,t,n){return{id:"loan_clusters",type:"circle",source:"kiva-loans",filter:["!=","cluster",!0],paint:{"circle-color":["case",e,n[0],t,n[1],n[1]],"circle-opacity":.6,"circle-radius":12}}}(d,h,v)),n.addLayer({id:"loan_dots",type:"symbol",source:"kiva-loans",filter:["!=","cluster",!0],layout:{"text-field":["number-format",["get","funded_amount"],{"min-fraction-digits":1,"max-fraction-digits":1}],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":10},paint:{"text-color":"white"}});var m={},b={};function g(){for(var e={},t=n.querySourceFeatures("kiva-loans"),a=0;a<t.length;a++){var r=t[a].geometry.coordinates,s=t[a].properties;if(s.cluster){var c=s.cluster_id,i=m[c];if(!i){var u=f(s,t.length,o,v);i=m[c]=new p.a.Marker({element:u}).setLngLat(r)}e[c]=i,b[c]||i.addTo(n)}}for(c in b)e[c]||b[c].remove();b=e}n.on("data",(function(e){"kiva-loans"===e.sourceId&&e.isSourceLoaded&&(n.on("move",g),n.on("moveend",g),g())})),n.on("click","loan_dots",(function(e){var t=e.features[0].geometry.coordinates.slice(),a=document.createElement("div");for(s.a.render(function(e){var t=e.tags&&JSON.parse(e.tags),n=e.use;return n&&n.length>300&&(n=n.substring(0,300)+"..."),r.a.createElement("div",{style:{width:200}},r.a.createElement("b",null,e.country_name),r.a.createElement("p",null,"Town: ",e.town),r.a.createElement("p",null,"Loan: $ ",e.loan_amount.toFixed(2)),r.a.createElement("p",null,"Funded: $ ",e.funded_amount.toFixed(2)),r.a.createElement("br",null),r.a.createElement("p",null,n),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement("b",null,Array.isArray(t)&&t.join(", "))))}(e.features[0].properties),a);Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;(new p.a.Popup).setLngLat(t).setDOMContent(a).addTo(n)})),n.on("mouseenter","loan_dots",(function(){n.getCanvas().style.cursor="pointer"})),n.on("mouseleave","loan_dots",(function(){n.getCanvas().style.cursor=""}))}))}return Object(a.useEffect)((function(){var e="992d6ea1-5cc8-4636-8b4a-4f6fede43f4c",t="13262d37-148e-45c7-8e4c-92bb8eb1fe79",n="/namespaces/".concat("kiva","/collections/").concat("loans","/"),a='?where={"posted_time": { "$gte": "2000-01-01" } }';function r(e){return o.apply(this,arguments)}function o(){return(o=Object(u.a)(i.a.mark((function a(r){var o,s,c;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,M({baseUrl:"https://".concat(e,"-").concat("us-east1",".apps.astra.datastax.com"),username:"kiva",password:"kiva123"},t);case 2:for(o=a.sent,s=[],c=0;c<r.length;c++)s.push(o.get(n+r[c]));Promise.all(s).then(function(){var e=Object(u.a)(i.a.mark((function e(t){var n,a,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a=0;case 2:if(!(a<r.length)){e.next=11;break}return e.next=5,t[a].json();case 5:o=e.sent,s=v(o.data),n.push(s);case 8:a++,e.next=2;break;case 11:w(n);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return a.stop()}}),a)})))).apply(this,arguments)}function s(){return(s=Object(u.a)(i.a.mark((function o(){var s,c,u;return i.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,M({baseUrl:"https://".concat(e,"-").concat("us-east1",".apps.astra.datastax.com"),username:"kiva",password:"kiva123"},t);case 2:return s=o.sent,o.next=5,s.get(n+a);case 5:return c=o.sent,o.next=8,c.json();case 8:u=o.sent,r(Object.keys(u.data));case 11:case"end":return o.stop()}}),o)})))).apply(this,arguments)}!function(){s.apply(this,arguments)}()}),[]),r.a.createElement("div",null,r.a.createElement("div",{className:"sidebarStyle"},r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("b",null,"STARGATE  ^ Colonel Jack")),"Longitude: ",o," | Latitude: ",m," | Zoom: ",k)),r.a.createElement("div",{className:"map-container",ref:e}))};var _=function(){return r.a.createElement("div",null,r.a.createElement(S,null))};s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(_,null)),document.getElementById("root"))},9:function(e,t,n){e.exports=n(21)}},[[9,1,2]]]);
//# sourceMappingURL=main.325c59c8.chunk.js.map